# RadiAssist API –°–µ—Ä–≤–∏—Å

REST API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ö–¢ –≥—Ä—É–¥–Ω–æ–π –∫–ª–µ—Ç–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI –º–æ–¥–µ–ª–µ–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ "–Ω–æ—Ä–º–∞/–ø–∞—Ç–æ–ª–æ–≥–∏—è".

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±–∑–æ—Ä pipeline

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**, –∫–æ–º–±–∏–Ω–∏—Ä—É—è –≥–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ (CNN) —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ (KSL):

```
DICOM Input ‚Üí Validation ‚Üí COVID19 CNN ‚Üí KSL Analysis ‚Üí Hybrid Aggregation ‚Üí Final Decision
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### 1Ô∏è‚É£ COVID19 Classifier (ResNet50 2D MIL)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–∞—Ç–æ–ª–æ–≥–∏–∏ –Ω–∞ –ö–¢ –≥—Ä—É–¥–Ω–æ–π –∫–ª–µ—Ç–∫–∏
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- ResNet50 —ç–Ω–∫–æ–¥–µ—Ä (–ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–π –Ω–∞ ImageNet)
- Attention-based Multiple Instance Learning (MIL)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ 64 –æ—Å–µ–≤—ã—Ö —Å—Ä–µ–∑–æ–≤, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ 256√ó256
- –í—ã—Ö–æ–¥: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–∞—Ç–æ–ª–æ–≥–∏–∏ [0.0-1.0]

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±—É—á–µ–Ω –Ω–∞ 1,210 –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö (COVID19_1110 + MosMedData Cancer)
- Val AUC: **0.9711** (–ª—É—á—à–∏–π —Ñ–æ–ª–¥: 0.9839)
- –†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏: 294MB

#### 2Ô∏è‚É£ KSL Z-profile Analyzer (ct_z.py)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∫—Ä–∏–Ω–∏–Ω–≥ –ø–æ —Å—Ä–µ–∑–∞–º - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ª—ë–≥–æ—á–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ –æ—Å–∏ Z

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü–µ—Ä-—Å—Ä–µ–∑–Ω–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ª—ë–≥–∫–∏—Ö (–ø–æ—Ä–æ–≥ HU < -500 + –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è)
2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ª–µ–≤–æ–µ/–ø—Ä–∞–≤–æ–µ –ª—ë–≥–∫–æ–µ
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —Å—Ä–µ–∑–µ:
   - **–ü–ª–æ—â–∞–¥—å –ª—ë–≥–∫–∏—Ö** (lung_area_px)
   - **–°—Ä–µ–¥–Ω–∏–π HU** (mean_lung_HU) - –æ–±—â–∞—è –∞—ç—Ä–∞—Ü–∏—è
   - **–ü–ª–æ—Ç–Ω–æ—Å—Ç—å >-500 HU** (frac_dense_m500) - –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è, –∏–Ω—Ñ–∏–ª—å—Ç—Ä–∞—Ç—ã
   - **–ü–ª–æ—Ç–Ω–æ—Å—Ç—å >-300 HU** (frac_dense_m300) - –≤—ã—Ä–∞–∂–µ–Ω–Ω–∞—è –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è
   - **–≠–º—Ñ–∏–∑–µ–º–∞ <-950 HU** (frac_emph_m950) - –≤–æ–∑–¥—É—à–Ω—ã–µ –ª–æ–≤—É—à–∫–∏
   - **L/R –∞—Å–∏–º–º–µ—Ç—Ä–∏—è** (LR_asym) - –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è

**–°–∫–æ—Ä –∞–Ω–æ–º–∞–ª—å–Ω–æ—Å—Ç–∏ [0.0-1.0]:**
```
Z-score = 0.45√ódense_m500 + 0.25√ómean_HU + 0.10√óLR_asym + 0.10√ó(1-lung_area)
```

**–í—ã—Ö–æ–¥:**
- Z-profile score - –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∞–Ω–æ–º–∞–ª—å–Ω–æ—Å—Ç–∏
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ z-—É—á–∞—Å—Ç–∫–∏ (score > 0.7)

#### 3Ô∏è‚É£ Hybrid Decision Logic (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CNN + KSL –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:**

1. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ COVID19**
   - –ï—Å–ª–∏ CNN –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å < 0.35 ‚Üí –ø—Ä–∏–º–µ–Ω–∏—Ç—å shift +0.10
   - –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π underestimation –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤**
   - –ï—Å–ª–∏ KSL > 0.55 && CNN < 0.25 ‚Üí clip KSL –¥–æ 0.45
   - –í—ã—Å–æ–∫–∏–π KSL –ø—Ä–∏ –Ω–∏–∑–∫–æ–º CNN –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, –∞ –Ω–µ –ø–∞—Ç–æ–ª–æ–≥–∏—é

3. **–í–∑–≤–µ—à–µ–Ω–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è**
   - KSL weight: 60% (–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å)
   - CNN weight: 40% (–ø–∞—Ç—Ç–µ—Ä–Ω-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ)
   - Hybrid prob = 0.6√óKSL + 0.4√óCNN

4. **–ú–Ω–æ–≥–æ–∫—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**
   - –ö–æ–º–±–∏–Ω–∞—Ü–∏—è: KSL positive + CNN > 0.40 ‚Üí –ø–∞—Ç–æ–ª–æ–≥–∏—è
   - High KSL alone: score > 0.47 ‚Üí –ø–∞—Ç–æ–ª–æ–≥–∏—è
   - Hybrid threshold: combined > 0.32 ‚Üí –ø–∞—Ç–æ–ª–æ–≥–∏—è

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **–≤—ã—Å–æ–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (–Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ç–æ–ª–æ–≥–∏—é)
- –õ—É—á—à–µ false positive, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ (–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–∫—Ä–∏–Ω–∏–Ω–≥)

### –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

- ‚ùå **LUNA16 Nodule Detector** - 3D –¥–µ—Ç–µ–∫—Ü–∏—è —É–∑–ª–æ–≤
- ‚ùå **Cancer Classifier** - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –º–∞–ª–∏–≥–Ω–∏–∑–∞—Ü–∏–∏ —É–∑–ª–æ–≤

*–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:* –í—ã—Å–æ–∫–∏–π FPR –Ω–∞ –¥–æ–±—Ä–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö (Spec=22%). –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö.

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚è±Ô∏è **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:** ~50-60 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª—É—á–∞–π (GPU)
- üéØ **–¢–æ—á–Ω–æ—Å—Ç—å –Ω–∞ LCT dataset:** 100% (3/3 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤)
- üíæ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU:** ~1GB –ø–∞–º—è—Ç–∏ (NVIDIA A30)
- üìä **Val AUC:** 0.9711 (COVID19 classifier)

## üì¶ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –≤–µ—Å–∞–º–∏ –º–æ–¥–µ–ª–µ–π

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Git LFS** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ COVID19 (~294–ú–ë):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Git LFS (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
# Ubuntu/Debian:
sudo apt install git-lfs

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Git LFS
git lfs install

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å LFS —Ñ–∞–π–ª–∞–º–∏
git clone https://github.com/nrm/chest-ct-ai-service.git
cd chest-ct-ai-service/api

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Å–æ–≤ –º–æ–¥–µ–ª–∏
ls -lh models/
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# covid19_classifier_fold1_best_auc.pth (~294–ú–ë)
```

### 2. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- **–û–°**: Ubuntu 22.04.5 LTS
- **GPU**: NVIDIA A30 (24GB)
- **–î—Ä–∞–π–≤–µ—Ä**: NVIDIA-SMI 570.172.08, Driver Version: 570.172.08
- **CUDA**: Version 12.8
- **Docker**: 20.10+ —Å nvidia-container-toolkit

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Docker 20.10+
- 8GB RAM (—Ä–µ–∂–∏–º GPU) –∏–ª–∏ 16GB RAM (—Ä–µ–∂–∏–º CPU)
- 10GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –†–µ–∂–∏–º GPU (–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
./run-gpu.sh

# –†–µ–∂–∏–º CPU
./run-cpu.sh

# –†—É—á–Ω–æ–π Docker Compose
docker-compose up --build

# API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8000
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python main.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–±–µ–∑ API)

–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–ø–∫–∏ —Å ZIP —Ñ–∞–π–ª–∞–º–∏ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ API —Å–µ—Ä–≤–µ—Ä–∞.

#### 3.1. Python —Å–∫—Ä–∏–ø—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö ZIP —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ
python batch_process.py --input /path/to/studies/

# –£–∫–∞–∑–∞—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª
python batch_process.py --input /path/to/studies/ --output results.xlsx

# CSV —Ñ–æ—Ä–º–∞—Ç
python batch_process.py --input /path/to/studies/ --output results.csv

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (2 –≤–æ—Ä–∫–µ—Ä–∞)
python batch_process.py --input /path/to/studies/ --workers 2
```

#### 3.2. Docker (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞)

```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç ./input –∏ ./output)
./run-batch.sh

# –£–∫–∞–∑–∞—Ç—å –ø–∞–ø–∫–∏
./run-batch.sh /path/to/studies /path/to/results

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ docker-compose
INPUT_DIR=/path/to/studies OUTPUT_DIR=/path/to/results \
  docker-compose -f docker-compose.batch.yml up
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ batch_process.py:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ API —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
- ‚úÖ Docker –∏–∑–æ–ª—è—Ü–∏—è (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å)

## üì° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

> **üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:** –°–º. **[API.md](API.md)** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤.

### Quick Start

**1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞:**
```bash
curl -X POST "http://localhost:8000/upload" \
  -F "file=@norma_anon.zip"
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
curl "http://localhost:8000/tasks/{task_id}/status"
```

**3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```bash
curl -J -O "http://localhost:8000/tasks/{task_id}/result/excel"
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `POST /upload` - –ó–∞–≥—Ä—É–∑–∫–∞ DICOM ZIP
- `GET /tasks/{task_id}/status` - –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `GET /tasks/{task_id}/result/excel` - Excel —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `GET /tasks/{task_id}/result/csv` - CSV —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `GET /health` - Health check

**–î–µ—Ç–∞–ª–∏:** –°–º. [API.md](API.md)

## üìä –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ö–∞–∫–∞—Ç–æ–Ω–∞:

**–ö–æ–ª–æ–Ω–∫–∏ Excel/CSV:**
- `path_to_study` - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è ZIP —Ñ–∞–π–ª–∞
- `study_uid` - DICOM Study UID
- `series_uid` - DICOM Series UID
- `probability_of_pathology` - –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–∞—Ç–æ–ª–æ–≥–∏–∏ (0.0-1.0)
- `pathology` - –ë–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (0=–Ω–æ—Ä–º–∞, 1=–ø–∞—Ç–æ–ª–æ–≥–∏—è)
- `processing_status` - –£—Å–ø–µ—Ö/–ù–µ—É–¥–∞—á–∞
- `time_of_processing` - –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- `most_dangerous_pathology_type` - –¢–∏–ø –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–π –ø–∞—Ç–æ–ª–æ–≥–∏–∏
- `pathology_localization` - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (x_min,x_max,y_min,y_max,z_min,z_max)

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (API —Ä–µ–∂–∏–º)

```bash
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –æ–±—Ä–∞–±–æ—Ç–∫–∏
export MAX_CONCURRENT_JOBS=2

# –¢–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
export PROCESSING_TIMEOUT=600

# –ó–∞–ø—É—Å–∫ API
python main.py
```

–ò–ª–∏ –≤ docker-compose.yml:
```yaml
environment:
  - MAX_CONCURRENT_JOBS=2
  - PROCESSING_TIMEOUT=600
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã batch_process.py

```bash
# –°–ø—Ä–∞–≤–∫–∞ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
python batch_process.py --help

# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
#   --input, -i   : –ü–∞–ø–∫–∞ —Å ZIP —Ñ–∞–π–ª–∞–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
#   --output, -o  : –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª .xlsx –∏–ª–∏ .csv (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
#   --workers, -w : –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
```

## üîß –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–ó–∞–≥—Ä—É–∑–∫–∞ DICOM** - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è DICOM —Ñ–∞–π–ª–æ–≤ –∏–∑ ZIP
2. **COVID19 Classifier** - –ê–Ω–∞–ª–∏–∑ 2D —Å—Ä–µ–∑–æ–≤ —Å –≤–Ω–∏–º–∞–Ω–∏–µ–º (ResNet50 MIL)
3. **KSL Z-profile** - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑ Z-–ø—Ä–æ—Ñ–∏–ª—è
4. **Hybrid Decision** - –ö–æ–º–±–∏–Ω–∞—Ü–∏—è CNN + KSL —Å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π:
   - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ COVID19: +0.10 –ø—Ä–∏ prob < 0.35
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ KSL: clip –ø—Ä–∏ z_score > 0.55 –∏ COVID19 < 0.25
   - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ—Ä–æ–≥: 0.32 –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ Sensitivity/Specificity
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞** - Excel/CSV —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–µ—Ç—Ä–∏–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**: 50-60 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª—É—á–∞–π (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ: ‚â§600—Å)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: ~2-4–ì–ë RAM, ~1–ì–ë GPU
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: ~60-70 –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π/—á–∞—Å (1 GPU)

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (—Å 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏)

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö:

**LCT Dataset (n=3):**
- Accuracy: 100% (95% CI: 43.8% - 100%)
- Sensitivity: 100% (95% CI: 34.2% - 100%)
- Specificity: 100% (95% CI: 5.5% - 100%)

**COVID19 Dataset (n=60):**
- Accuracy: 50.0% (95% CI: 37.6% - 62.4%)
- Sensitivity: 60.0% (95% CI: 42.3% - 75.4%)
- Specificity: 40.0% (95% CI: 24.6% - 57.7%)

**Cancer Dataset (n=20):**
- Accuracy: 55.0% (95% CI: 33.2% - 75.0%)
- Sensitivity: 88.9% (95% CI: 56.5% - 98.0%)
- Specificity: 27.3% (95% CI: 9.0% - 56.6%)

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –®–∏—Ä–æ–∫–∏–µ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±—É—Å–ª–æ–≤–ª–µ–Ω—ã –º–∞–ª—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–∫. –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞ Sensitivity (–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø–∞—Ç–æ–ª–æ–≥–∏–π).

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DICOM ZIP —Ñ–∞–π–ª–æ–≤ –¥–æ 1–ì–ë
- –ú–∞–∫—Å–∏–º—É–º 2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –¢–∞–π–º–∞—É—Ç: 10 –º–∏–Ω—É—Ç –Ω–∞ –∑–∞–¥–∞—á—É (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

## üìÅ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (API —Ä–µ–∂–∏–º)

```
data/
‚îú‚îÄ‚îÄ uploads/
‚îÇ   ‚îú‚îÄ‚îÄ task_uuid_1/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ norma_anon.zip
‚îÇ   ‚îî‚îÄ‚îÄ task_uuid_2/
‚îÇ       ‚îî‚îÄ‚îÄ pneumonia_anon.zip
‚îî‚îÄ‚îÄ results/
    ‚îú‚îÄ‚îÄ task_uuid_1/
    ‚îÇ   ‚îú‚îÄ‚îÄ hackathon_test_results.xlsx
    ‚îÇ   ‚îî‚îÄ‚îÄ hackathon_test_results.csv
    ‚îî‚îÄ‚îÄ task_uuid_2/
        ‚îú‚îÄ‚îÄ hackathon_test_results.xlsx
        ‚îî‚îÄ‚îÄ hackathon_test_results.csv
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å Git LFS

–ï—Å–ª–∏ –≤–µ—Å–∞ –º–æ–¥–µ–ª–µ–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Git LFS
git lfs status

# –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ LFS —Ñ–∞–π–ª–æ–≤
git lfs pull

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –º–æ–¥–µ–ª–∏
ls -lh models/
# covid19_classifier_fold1_best_auc.pth –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~294–ú–ë

# –ï—Å–ª–∏ —Ñ–∞–π–ª –º–∞–ª–µ–Ω—å–∫–∏–π (< 1–ö–ë), —ç—Ç–æ LFS —É–∫–∞–∑–∞—Ç–µ–ª—å:
git lfs checkout
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å–±–æ—Ä–∫–∏ Docker

**–û—à–∏–±–∫–∞**: `ModuleNotFoundError` –∏–ª–∏ `FileNotFoundError` –¥–ª—è –º–æ–¥–µ–ª–µ–π
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥–µ–ª—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π
ls -lh models/covid19_classifier_fold1_best_auc.pth
# –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
git lfs pull
```

### –ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–∞—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~1GB –ø–∞–º—è—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `nvidia-smi` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ GPU
- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ CPU: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±—É–¥–µ—Ç –≤ 3-5 —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–µ–µ

### –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
# API —Ä–µ–∂–∏–º
docker logs radiassist-api

# batch_process.py
# –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
```

## üìÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[API.md](API.md)** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API
- **[BATCH_PROCESSING.md](BATCH_PROCESSING.md)** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
- **[BUILD.md](BUILD.md)** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–æ–≤
- **[main.py](main.py)** - API —Å–µ—Ä–≤–µ—Ä (FastAPI)
- **[batch_process.py](batch_process.py)** - –°–∫—Ä–∏–ø—Ç –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **[utils/metrics.py](utils/metrics.py)** - –ú–µ—Ç—Ä–∏–∫–∏ —Å 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏

## üè• –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞:
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç Sensitivity**: –õ—É—á—à–µ –ª–æ–∂–Ω–∞—è —Ç—Ä–µ–≤–æ–≥–∞, —á–µ–º –ø—Ä–æ–ø—É—â–µ–Ω–Ω–∞—è –ø–∞—Ç–æ–ª–æ–≥–∏—è
- **Adaptive Calibration**: –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–º–µ—â–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
- **KSL Protection**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
- **Hybrid Logic**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è CNN –∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ø–æ–º–æ—â–∏ –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π, –∞ –Ω–µ –∑–∞–º–µ–Ω—ã –≤—Ä–∞—á–∞-—Ä–µ–Ω—Ç–≥–µ–Ω–æ–ª–æ–≥–∞.
